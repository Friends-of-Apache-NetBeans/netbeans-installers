      - name: "Notarize and Staple"
        env:
          PROD_MACOS_NOTARIZATION_APPLE_ID: ${{ vars.APPLE_ID }}
          PROD_MACOS_NOTARIZATION_TEAM_ID: ${{ vars.APPLE_TEAM_ID }}
          PROD_MACOS_NOTARIZATION_PWD: ${{ secrets.APP_SPECIFIC_PASSWORD }}
        run: |
          # Store the notarization credentials so that we can prevent a UI password dialog
          # from blocking the CI
          echo "Create keychain profile"
          xcrun notarytool store-credentials "signer" --apple-id "$PROD_MACOS_NOTARIZATION_APPLE_ID" --team-id "$PROD_MACOS_NOTARIZATION_TEAM_ID" --password "$PROD_MACOS_NOTARIZATION_PWD"

          # Here we send the notarization request to the Apple's Notarization service, waiting for the result.
          # This typically takes a few seconds inside a CI environment, but it might take more depending on the App
          # characteristics. Visit the Notarization docs for more information and strategies on how to optimize it if
          # you're curious
          mypackage=$(find dist/ -name "*.pkg" -type f)
          echo "Notarize app ${mypackage}"
          xcrun notarytool submit ${mypackage} --keychain-profile "signer" --wait

          # Finally, we need to "attach the staple" to our executable, which will allow our app to be
          # validated by macOS even when an internet connection is not available.
          echo "Attach staple"
          xcrun stapler staple ${mypackage}
          # since the package itself has been changed by the staple step, we need to recompute the sha256sum
          shasum=$(sha256sum artifacts/macos-pkg-arm64/Apache-NetBeans-28-arm64.pkg | cut -c 1-64)
          bname=$(basename ${mypackage})
          yamlfile="$(basename $bname .pkg).yaml"
          echo "${bname}  $shasum" > dist/$bname.sha256
          echo "macos-pkg-arm-file: ${bname}" > dist/${yamlfile}
          echo "macos-pkg-arm-hash: ${shasum}" >> dist/${yamlfile}
