# publish release to netbeans-installers-site
name: Publish
on: 
  workflow_dispatch:

jobs:
  UpdateWeb:
    name: Checkout this repo and website 
    runs-on: ubuntu-24.04
    steps:
      - name: co-myrepo
        uses: actions/checkout@v6
        with: 
          persist-credentials: true
          path: installers
      - name: co-web
        uses: actions/checkout@v6
        with: 
          persist-credentials: true
          repository: Friends-of-Apache-NetBeans/netbeans-installers-site
          path: site
      - name: show site
        run: |
          find site -type f
      - name: create-web-files
        run: |
          (
          cd installers
          nbversion=$(cat build.properties | grep netbeans.version | cut -d= -f2)
          cat - <<EOF > ../site/nb${nbversion}.md
          ---
          layout: release
          sb: nb${version}
          ---
          EOF
          gh release download -D ../site/_data --clobber -p "*.yaml"
          find ../site
          )
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: commit-web-changes
        shell: bash
        env: 
          CI_COMMIT_MESSAGE: update website for publication
          CI_COMMIT_AUTHOR: github-actions[bot]
          CI_COMMIT_EMAIL: username@users.noreply.github.com
        run: |
          cd site
          ls _data
          ls *.md
          git config --unset-all http.https://github.com/.extraheader
          git config --global user.name ${{ env.CI_COMMIT_AUTHOR }}
          git config --global user.email ${{ env.CI_COMMIT_EMAIL }}
          git add .
          git commit -m "update website for publication"
          git push

          

